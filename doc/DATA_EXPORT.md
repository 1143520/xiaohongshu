# 数据导出备份功能

## 功能概述

管理后台新增了一键导出备份功能，允许管理员快速导出整个系统的数据用于备份、迁移或分析。

## 功能特点

### 🚀 一键导出

- 无需复杂配置，点击即可导出
- 自动生成时间戳文件名
- 支持浏览器直接下载

### 📊 导出预览

- 实时显示各类数据统计
- 显示数据库大小信息
- 确认后再执行导出

### 🔒 安全考虑

- 用户密码字段已脱敏处理
- 敏感信息自动过滤
- 仅管理员可访问

## 导出内容

### 用户数据 (users)

- 用户基本信息（脱敏处理）
- 用户统计数据
- 用户配置信息

### 内容数据

- **帖子数据 (posts)**: 所有发布的帖子和草稿
- **帖子图片 (post_images)**: 帖子关联的图片 URL
- **评论数据 (comments)**: 所有评论和回复
- **标签数据 (tags)**: 标签信息和使用统计

### 关系数据

- **关注关系 (follows)**: 用户关注关系
- **点赞数据 (likes)**: 帖子和评论的点赞记录
- **收藏数据 (collections)**: 用户收藏的帖子

### 系统数据

- **通知数据 (notifications)**: 系统通知记录
- **系统设置 (system_settings)**: 全局配置信息

## 使用方法

### 1. 访问导出功能

- 登录管理后台
- 进入系统设置页面 (`/admin/settings`)
- 找到"数据管理"部分

### 2. 预览导出数据

- 点击"一键导出"按钮
- 查看导出预览统计信息
- 确认数据范围和大小

### 3. 执行导出

- 点击"确认导出"按钮
- 等待数据处理完成
- 自动下载 JSON 文件

## 导出文件格式

```json
{
  "exportTime": "2025-09-07T12:00:00.000Z",
  "version": "1.0.0",
  "data": {
    "users": [...],
    "posts": [...],
    "comments": [...],
    "tags": [...],
    "post_images": [...],
    "post_tags": [...],
    "follows": [...],
    "likes": [...],
    "collections": [...],
    "notifications": [...],
    "system_settings": [...]
  },
  "statistics": {
    "total_users": 100,
    "total_posts": 500,
    "total_comments": 1000,
    "total_tags": 50,
    "total_follows": 200,
    "total_likes": 1500,
    "total_collections": 300,
    "total_notifications": 800
  }
}
```

## API 接口

### 导出预览

```http
GET /api/export/preview
```

返回导出统计信息，用于显示预览。

### 执行导出

```http
GET /api/export
```

返回完整的 JSON 数据文件。

## 注意事项

### 数据安全

- ❌ 不包含用户密码（已脱敏）
- ❌ 不包含管理员密码
- ❌ 不包含会话令牌
- ✅ 包含所有业务数据

### 文件大小

- 根据数据量自动调整
- 大型数据库可能生成较大文件
- 建议在服务器负载较低时导出

### 使用建议

- 定期备份重要数据
- 在系统升级前备份
- 用于数据迁移和灾难恢复

## 故障排除

### 导出失败

1. 检查服务器磁盘空间
2. 确认数据库连接正常
3. 查看服务器错误日志

### 下载中断

1. 检查网络连接稳定性
2. 尝试重新导出
3. 考虑在服务器端生成文件

### 数据不完整

1. 确认所有服务正常运行
2. 检查数据库表是否存在
3. 验证权限配置正确

## 技术实现

### 后端 (Express)

- `/routes/export.js` - 导出路由处理
- 数据库查询优化
- 内存使用优化

### 前端 (Vue3)

- 导出预览界面
- 进度提示
- 文件下载处理

### 安全措施

- 管理员权限验证（可选）
- 数据脱敏处理
- 错误处理和日志记录
